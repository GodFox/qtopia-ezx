
# test alt attributes based on 3GPP spec example
# NOTE: This case doesn't have alt-group info so the 
#       default should be picked
# v=0
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2

# set selection criteria and select the stream
Reset
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 12000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=1
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# test alt attributes based on 3GPP spec example
# NOTE: This is the same SDP as the previous case
#       except alt-group info was added
#       
# v=0
# a=alt-group:BW:AS:12=1;16=2
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 16 0 2
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2

# set selection criteria and select the stream
Reset
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 16000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=2
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# test alt attributes based on 3GPP spec example
# NOTE: This is the same SDP as the previous case
#       except we'll set the max bandwith to
#       13k so that the lower bitrate stream
#       gets selected
#       
# v=0
# a=alt-group:BW:AS:12=1;16=2
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 16 0 2
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2

# set selection criteria and select the stream
Reset
AddMaxBWFilter 13000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 12000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=1
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# test alt attributes based on 3GPP spec example
# NOTE: This is a case where there is no alt-default-id
#       field present. The default stream should be selected
#       in this case
#       
# v=0
# a=alt-group:BW:AS:12=1;16=2
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 16 0 2
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2

# set selection criteria and select the stream
Reset
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 12000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=1
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# test the case where an alt has a different mimetype
# v=0
# a=alt-group:BW:AS:12=1;18=2
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:18
# a=alt:2:a=control:trackID=2
# a=alt:2:a=rtpmap:97 AMR-WB/16000

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 18 0 2
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 18000
AHTH::AddAltULONG32 1 2 SamplesPerSecond 16000
AHTH::AddAltCString 1 2 Control trackID=2
AHTH::AddAltCString 1 2 MimeType audio/AMR-WB

# set selection criteria and select the stream
Reset
AddMaxBWFilter 30000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 18000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 16000
StringCount 1 3
GetString 1 Control trackID=2
GetString 1 Mimetype "audio/AMR-WB"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# test the case where an alt has a different mimetype
# NOTE: Same as previous case but the max bitrate is
#       lowered so that the second stream will get 
#       selected
#
# v=0
# a=alt-group:BW:AS:12=1;18=2
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:18
# a=alt:2:a=control:trackID=2
# a=alt:2:a=rtpmap:97 AMR-WB/16000

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 18 0 2
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 18000
AHTH::AddAltULONG32 1 2 SamplesPerSecond 16000
AHTH::AddAltCString 1 2 Control trackID=2
AHTH::AddAltCString 1 2 MimeType audio/AMR-WB

# set selection criteria and select the stream
Reset
AddMaxBWFilter 12000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 12000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=1
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# test the case where an alt has a different mimetype, but
# the bitrates of the streams are the same
# NOTE : The first group for the bitrate should be picked
#
# v=0
# a=alt-group:BW:AS:12=1;12=2
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:12
# a=alt:2:a=control:trackID=2
# a=alt:2:a=rtpmap:97 AMR-WB/16000

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 12 1 2
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 12000
AHTH::AddAltULONG32 1 2 SamplesPerSecond 16000
AHTH::AddAltCString 1 2 Control trackID=2
AHTH::AddAltCString 1 2 MimeType audio/AMR-WB

# set selection criteria and select the stream
Reset
AddMaxBWFilter 30000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 12000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=1
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# test the case where an alt has a different mimetype, but
# the bitrates of the streams are the same
# NOTE : This is the same as the previous case except that 
#        the groups were swapped so we can verify the first
#        one is picked
#
# v=0
# a=alt-group:BW:AS:12=2;12=1
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:12
# a=alt:2:a=control:trackID=2
# a=alt:2:a=rtpmap:97 AMR-WB/16000

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddAltGroupID BW:AS 12 0 2
AHTH::AddAltGroupID BW:AS 12 1 1
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 12000
AHTH::AddAltULONG32 1 2 SamplesPerSecond 16000
AHTH::AddAltCString 1 2 Control trackID=2
AHTH::AddAltCString 1 2 MimeType audio/AMR-WB

# set selection criteria and select the stream
Reset
AddMaxBWFilter 30000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 12000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 16000
StringCount 1 3
GetString 1 Control trackID=2
GetString 1 Mimetype "audio/AMR-WB"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0


# test alt & alt-group attributes. Based on 3GPP spec example
# NOTE: max BW set so that the highest stream is picked
#
# v=0
# o=ericsson_user 1 1 IN IP4 130.240.188.69
# s=A basic audio and video presentation
# c=IN IP4 0.0.0.0
# b=AS:56
# a=control:*
# a=range:npt=0-150.2
# a=alt-group:BW:AS:28=1,3;56=1,4;60=2,4;120=2,5
# t=0 0
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2
# m=video 0 RTP/AVP 98
# b=AS:44
# a=rtpmap:98 MP4V-ES/90000
# a=control:trackID=4
# a=fmtp:98 profile-level-id=8; config=01010000012000884006682C2090A21F
# a=range:npt=0-150.2
# a=X-initpredecbufperiod:98000
# a=alt-default-id:4
# a=alt:3:b=AS:16
# a=alt:3:a=control:trackID=3
# a=alt:3:a=X-initpredecbufperiod:48000
# a=alt:5:b=AS:104
# a=alt:5:a=control:trackID=5
# a=alt:5:a=X-initpredecbufperiod:150000

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 2
AHTH::AddULONG32 0 Duration 150199
AHTH::AddULONG32 0 AvgBitRate 56000
AHTH::AddCString 0 Control *
AHTH::AddCString 0 MulticastAddress 0.0.0.0
AHTH::AddAltGroupID BW:AS 28 0 1
AHTH::AddAltGroupID BW:AS 28 0 3
AHTH::AddAltGroupID BW:AS 56 0 1
AHTH::AddAltGroupID BW:AS 56 0 4
AHTH::AddAltGroupID BW:AS 60 0 2
AHTH::AddAltGroupID BW:AS 60 0 4
AHTH::AddAltGroupID BW:AS 120 0 2
AHTH::AddAltGroupID BW:AS 120 0 5
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddCString 1 MimeType audio/AMR
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2
AHTH::AddULONG32 2 StreamNumber 1
AHTH::AddULONG32 2 Duration 150199
AHTH::AddULONG32 2 RTPPayloadType 98
AHTH::AddULONG32 2 AvgBitRate 44000
AHTH::AddULONG32 2 SamplesPerSecond 90000
AHTH::AddULONG32 2 alt-default-id 4
AHTH::AddULONG32 2 FMTPprofile-level-id 8
AHTH::AddULONG32 2 Preroll 1088
AHTH::AddCString 2 MimeType video/MP4V-ES
AHTH::AddCString 2 Control trackID=4
AHTH::AddCString 2 PayloadParameters "profile-level-id=8; config=01010000012000884006682C2090A21F"
AHTH::AddCString 2 FMTPconfig "01010000012000884006682C2090A21F"
AHTH::AddAltULONG32 2 3 AvgBitRate 16000
AHTH::AddAltULONG32 2 3 Preroll 533
AHTH::AddAltCString 2 3 Control trackID=3
AHTH::AddAltULONG32 2 5 AvgBitRate 104000
AHTH::AddAltCString 2 5 Control trackID=5
AHTH::AddAltULONG32 2 5 Preroll 1666

# set selection criteria and select the stream
Reset
AddMaxBWFilter 1000000
AddHighestBWFilter
Select

# check session level fields
IntCount 0 3
GetInt 0 StreamCount 2
GetInt 0 Duration 150199
GetInt 0 AvgBitRate 56000
StringCount 0 2
GetString 0 Control *
GetString 0 MulticastAddress 0.0.0.0
BufferCount 0 0
ObjectCount 0 0

# check stream 0 fields
IntCount 1 6
GetInt 1 StreamNumber 0
GetInt 1 Duration 150199
GetInt 1 RTPPayloadType 97
GetInt 1 AvgBitRate 16000
GetInt 1 SamplesPerSecond 8000
GetInt 1 FMTPoctet-align 1
StringCount 1 3
GetString 1 MimeType audio/AMR
GetString 1 Control trackID=2
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# check stream 1 fields
IntCount 2 7
GetInt 2 StreamNumber 1
GetInt 2 Duration 150199
GetInt 2 RTPPayloadType 98
GetInt 2 AvgBitRate 104000
GetInt 2 SamplesPerSecond 90000
GetInt 2 FMTPprofile-level-id 8
GetInt 2 Preroll 1666
StringCount 2 4
GetString 2 MimeType video/MP4V-ES
GetString 2 Control trackID=5
GetString 2 PayloadParameters "profile-level-id=8; config=01010000012000884006682C2090A21F"
GetString 2 FMTPconfig "01010000012000884006682C2090A21F"
BufferCount 2 0
ObjectCount 2 0

# test alt & alt-group attributes. Based on 3GPP spec example
# NOTE: max BW set so that the second highest stream is picked
#
# v=0
# o=ericsson_user 1 1 IN IP4 130.240.188.69
# s=A basic audio and video presentation
# c=IN IP4 0.0.0.0
# b=AS:56
# a=control:*
# a=range:npt=0-150.2
# a=alt-group:BW:AS:28=1,3;56=1,4;60=2,4;120=2,5
# t=0 0
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2
# m=video 0 RTP/AVP 98
# b=AS:44
# a=rtpmap:98 MP4V-ES/90000
# a=control:trackID=4
# a=fmtp:98 profile-level-id=8; config=01010000012000884006682C2090A21F
# a=range:npt=0-150.2
# a=X-initpredecbufperiod:98000
# a=alt-default-id:4
# a=alt:3:b=AS:16
# a=alt:3:a=control:trackID=3
# a=alt:3:a=X-initpredecbufperiod:48000
# a=alt:5:b=AS:104
# a=alt:5:a=control:trackID=5
# a=alt:5:a=X-initpredecbufperiod:150000

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 2
AHTH::AddULONG32 0 Duration 150199
AHTH::AddULONG32 0 AvgBitRate 56000
AHTH::AddCString 0 Control *
AHTH::AddCString 0 MulticastAddress 0.0.0.0
AHTH::AddAltGroupID BW:AS 28 0 1
AHTH::AddAltGroupID BW:AS 28 0 3
AHTH::AddAltGroupID BW:AS 56 0 1
AHTH::AddAltGroupID BW:AS 56 0 4
AHTH::AddAltGroupID BW:AS 60 0 2
AHTH::AddAltGroupID BW:AS 60 0 4
AHTH::AddAltGroupID BW:AS 120 0 2
AHTH::AddAltGroupID BW:AS 120 0 5
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddCString 1 MimeType audio/AMR
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2
AHTH::AddULONG32 2 StreamNumber 1
AHTH::AddULONG32 2 Duration 150199
AHTH::AddULONG32 2 RTPPayloadType 98
AHTH::AddULONG32 2 AvgBitRate 44000
AHTH::AddULONG32 2 SamplesPerSecond 90000
AHTH::AddULONG32 2 alt-default-id 4
AHTH::AddULONG32 2 FMTPprofile-level-id 8
AHTH::AddULONG32 2 Preroll 1088
AHTH::AddCString 2 MimeType video/MP4V-ES
AHTH::AddCString 2 Control trackID=4
AHTH::AddCString 2 PayloadParameters "profile-level-id=8; config=01010000012000884006682C2090A21F"
AHTH::AddCString 2 FMTPconfig "01010000012000884006682C2090A21F"
AHTH::AddAltULONG32 2 3 AvgBitRate 16000
AHTH::AddAltULONG32 2 3 Preroll 533
AHTH::AddAltCString 2 3 Control trackID=3
AHTH::AddAltULONG32 2 5 AvgBitRate 104000
AHTH::AddAltCString 2 5 Control trackID=5
AHTH::AddAltULONG32 2 5 Preroll 1666

# set selection criteria and select the stream
Reset
AddMaxBWFilter 100000
AddHighestBWFilter
Select

# check session level fields
IntCount 0 3
GetInt 0 StreamCount 2
GetInt 0 Duration 150199
GetInt 0 AvgBitRate 56000
StringCount 0 2
GetString 0 Control *
GetString 0 MulticastAddress 0.0.0.0
BufferCount 0 0
ObjectCount 0 0

# check stream 0 fields
IntCount 1 6
GetInt 1 StreamNumber 0
GetInt 1 Duration 150199
GetInt 1 RTPPayloadType 97
GetInt 1 AvgBitRate 16000
GetInt 1 SamplesPerSecond 8000
GetInt 1 FMTPoctet-align 1
StringCount 1 3
GetString 1 MimeType audio/AMR
GetString 1 Control trackID=2
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# check stream 1 fields
IntCount 2 7
GetInt 2 StreamNumber 1
GetInt 2 Duration 150199
GetInt 2 RTPPayloadType 98
GetInt 2 AvgBitRate 44000
GetInt 2 SamplesPerSecond 90000
GetInt 2 FMTPprofile-level-id 8
GetInt 2 Preroll 1088
StringCount 2 4
GetString 2 MimeType video/MP4V-ES
GetString 2 Control trackID=4
GetString 2 PayloadParameters "profile-level-id=8; config=01010000012000884006682C2090A21F"
GetString 2 FMTPconfig "01010000012000884006682C2090A21F"
BufferCount 2 0
ObjectCount 2 0

# test alt & alt-group attributes. Based on 3GPP spec example
# NOTE: max BW set so that the second lowest stream is picked
#
# v=0
# o=ericsson_user 1 1 IN IP4 130.240.188.69
# s=A basic audio and video presentation
# c=IN IP4 0.0.0.0
# b=AS:56
# a=control:*
# a=range:npt=0-150.2
# a=alt-group:BW:AS:28=1,3;56=1,4;60=2,4;120=2,5
# t=0 0
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2
# m=video 0 RTP/AVP 98
# b=AS:44
# a=rtpmap:98 MP4V-ES/90000
# a=control:trackID=4
# a=fmtp:98 profile-level-id=8; config=01010000012000884006682C2090A21F
# a=range:npt=0-150.2
# a=X-initpredecbufperiod:98000
# a=alt-default-id:4
# a=alt:3:b=AS:16
# a=alt:3:a=control:trackID=3
# a=alt:3:a=X-initpredecbufperiod:48000
# a=alt:5:b=AS:104
# a=alt:5:a=control:trackID=5
# a=alt:5:a=X-initpredecbufperiod:150000

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 2
AHTH::AddULONG32 0 Duration 150199
AHTH::AddULONG32 0 AvgBitRate 56000
AHTH::AddCString 0 Control *
AHTH::AddCString 0 MulticastAddress 0.0.0.0
AHTH::AddAltGroupID BW:AS 28 0 1
AHTH::AddAltGroupID BW:AS 28 0 3
AHTH::AddAltGroupID BW:AS 56 0 1
AHTH::AddAltGroupID BW:AS 56 0 4
AHTH::AddAltGroupID BW:AS 60 0 2
AHTH::AddAltGroupID BW:AS 60 0 4
AHTH::AddAltGroupID BW:AS 120 0 2
AHTH::AddAltGroupID BW:AS 120 0 5
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddCString 1 MimeType audio/AMR
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2
AHTH::AddULONG32 2 StreamNumber 1
AHTH::AddULONG32 2 Duration 150199
AHTH::AddULONG32 2 RTPPayloadType 98
AHTH::AddULONG32 2 AvgBitRate 44000
AHTH::AddULONG32 2 SamplesPerSecond 90000
AHTH::AddULONG32 2 alt-default-id 4
AHTH::AddULONG32 2 FMTPprofile-level-id 8
AHTH::AddULONG32 2 Preroll 1088
AHTH::AddCString 2 MimeType video/MP4V-ES
AHTH::AddCString 2 Control trackID=4
AHTH::AddCString 2 PayloadParameters "profile-level-id=8; config=01010000012000884006682C2090A21F"
AHTH::AddCString 2 FMTPconfig "01010000012000884006682C2090A21F"
AHTH::AddAltULONG32 2 3 AvgBitRate 16000
AHTH::AddAltULONG32 2 3 Preroll 533
AHTH::AddAltCString 2 3 Control trackID=3
AHTH::AddAltULONG32 2 5 AvgBitRate 104000
AHTH::AddAltCString 2 5 Control trackID=5
AHTH::AddAltULONG32 2 5 Preroll 1666

# set selection criteria and select the stream
Reset
AddMaxBWFilter 56000
AddHighestBWFilter
Select

# check session level fields
IntCount 0 3
GetInt 0 StreamCount 2
GetInt 0 Duration 150199
GetInt 0 AvgBitRate 56000
StringCount 0 2
GetString 0 Control *
GetString 0 MulticastAddress 0.0.0.0
BufferCount 0 0
ObjectCount 0 0

# check stream 0 fields
IntCount 1 6
GetInt 1 StreamNumber 0
GetInt 1 Duration 150199
GetInt 1 RTPPayloadType 97
GetInt 1 AvgBitRate 12000
GetInt 1 SamplesPerSecond 8000
GetInt 1 FMTPoctet-align 1
StringCount 1 3
GetString 1 MimeType audio/AMR
GetString 1 Control trackID=1
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# check stream 1 fields
IntCount 2 7
GetInt 2 StreamNumber 1
GetInt 2 Duration 150199
GetInt 2 RTPPayloadType 98
GetInt 2 AvgBitRate 44000
GetInt 2 SamplesPerSecond 90000
GetInt 2 FMTPprofile-level-id 8
GetInt 2 Preroll 1088
StringCount 2 4
GetString 2 MimeType video/MP4V-ES
GetString 2 Control trackID=4
GetString 2 PayloadParameters "profile-level-id=8; config=01010000012000884006682C2090A21F"
GetString 2 FMTPconfig "01010000012000884006682C2090A21F"
BufferCount 2 0
ObjectCount 2 0

# test alt & alt-group attributes. Based on 3GPP spec example
# NOTE: max BW set so that the lowest stream is picked
#
# v=0
# o=ericsson_user 1 1 IN IP4 130.240.188.69
# s=A basic audio and video presentation
# c=IN IP4 0.0.0.0
# b=AS:56
# a=control:*
# a=range:npt=0-150.2
# a=alt-group:BW:AS:28=1,3;56=1,4;60=2,4;120=2,5
# t=0 0
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2
# m=video 0 RTP/AVP 98
# b=AS:44
# a=rtpmap:98 MP4V-ES/90000
# a=control:trackID=4
# a=fmtp:98 profile-level-id=8; config=01010000012000884006682C2090A21F
# a=range:npt=0-150.2
# a=X-initpredecbufperiod:98000
# a=alt-default-id:4
# a=alt:3:b=AS:16
# a=alt:3:a=control:trackID=3
# a=alt:3:a=X-initpredecbufperiod:48000
# a=alt:5:b=AS:104
# a=alt:5:a=control:trackID=5
# a=alt:5:a=X-initpredecbufperiod:150000

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 2
AHTH::AddULONG32 0 Duration 150199
AHTH::AddULONG32 0 AvgBitRate 56000
AHTH::AddCString 0 Control *
AHTH::AddCString 0 MulticastAddress 0.0.0.0
AHTH::AddAltGroupID BW:AS 28 0 1
AHTH::AddAltGroupID BW:AS 28 0 3
AHTH::AddAltGroupID BW:AS 56 0 1
AHTH::AddAltGroupID BW:AS 56 0 4
AHTH::AddAltGroupID BW:AS 60 0 2
AHTH::AddAltGroupID BW:AS 60 0 4
AHTH::AddAltGroupID BW:AS 120 0 2
AHTH::AddAltGroupID BW:AS 120 0 5
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddCString 1 MimeType audio/AMR
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2
AHTH::AddULONG32 2 StreamNumber 1
AHTH::AddULONG32 2 Duration 150199
AHTH::AddULONG32 2 RTPPayloadType 98
AHTH::AddULONG32 2 AvgBitRate 44000
AHTH::AddULONG32 2 SamplesPerSecond 90000
AHTH::AddULONG32 2 alt-default-id 4
AHTH::AddULONG32 2 FMTPprofile-level-id 8
AHTH::AddULONG32 2 Preroll 1088
AHTH::AddCString 2 MimeType video/MP4V-ES
AHTH::AddCString 2 Control trackID=4
AHTH::AddCString 2 PayloadParameters "profile-level-id=8; config=01010000012000884006682C2090A21F"
AHTH::AddCString 2 FMTPconfig "01010000012000884006682C2090A21F"
AHTH::AddAltULONG32 2 3 AvgBitRate 16000
AHTH::AddAltULONG32 2 3 Preroll 533
AHTH::AddAltCString 2 3 Control trackID=3
AHTH::AddAltULONG32 2 5 AvgBitRate 104000
AHTH::AddAltCString 2 5 Control trackID=5
AHTH::AddAltULONG32 2 5 Preroll 1666

# set selection criteria and select the stream
Reset
AddMaxBWFilter 30000
AddHighestBWFilter
Select

# check session level fields
IntCount 0 3
GetInt 0 StreamCount 2
GetInt 0 Duration 150199
GetInt 0 AvgBitRate 56000
StringCount 0 2
GetString 0 Control *
GetString 0 MulticastAddress 0.0.0.0
BufferCount 0 0
ObjectCount 0 0

# check stream 0 fields
IntCount 1 6
GetInt 1 StreamNumber 0
GetInt 1 Duration 150199
GetInt 1 RTPPayloadType 97
GetInt 1 AvgBitRate 12000
GetInt 1 SamplesPerSecond 8000
GetInt 1 FMTPoctet-align 1
StringCount 1 3
GetString 1 MimeType audio/AMR
GetString 1 Control trackID=1
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# check stream 1 fields
IntCount 2 7
GetInt 2 StreamNumber 1
GetInt 2 Duration 150199
GetInt 2 RTPPayloadType 98
GetInt 2 AvgBitRate 16000
GetInt 2 SamplesPerSecond 90000
GetInt 2 FMTPprofile-level-id 8
GetInt 2 Preroll 533
StringCount 2 4
GetString 2 MimeType video/MP4V-ES
GetString 2 Control trackID=3
GetString 2 PayloadParameters "profile-level-id=8; config=01010000012000884006682C2090A21F"
GetString 2 FMTPconfig "01010000012000884006682C2090A21F"
BufferCount 2 0
ObjectCount 2 0

# test alt & alt-group attributes. Based on 3GPP spec example
# NOTE: max BW set below the lowest bitrate. The default streams
#       should be selected
#
# v=0
# o=ericsson_user 1 1 IN IP4 130.240.188.69
# s=A basic audio and video presentation
# c=IN IP4 0.0.0.0
# b=AS:56
# a=control:*
# a=range:npt=0-150.2
# a=alt-group:BW:AS:28=1,3;56=1,4;60=2,4;120=2,5
# t=0 0
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2
# m=video 0 RTP/AVP 98
# b=AS:44
# a=rtpmap:98 MP4V-ES/90000
# a=control:trackID=4
# a=fmtp:98 profile-level-id=8; config=01010000012000884006682C2090A21F
# a=range:npt=0-150.2
# a=X-initpredecbufperiod:98000
# a=alt-default-id:4
# a=alt:3:b=AS:16
# a=alt:3:a=control:trackID=3
# a=alt:3:a=X-initpredecbufperiod:48000
# a=alt:5:b=AS:104
# a=alt:5:a=control:trackID=5
# a=alt:5:a=X-initpredecbufperiod:150000

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 2
AHTH::AddULONG32 0 Duration 150199
AHTH::AddULONG32 0 AvgBitRate 56000
AHTH::AddCString 0 Control *
AHTH::AddCString 0 MulticastAddress 0.0.0.0
AHTH::AddAltGroupID BW:AS 28 0 1
AHTH::AddAltGroupID BW:AS 28 0 3
AHTH::AddAltGroupID BW:AS 56 0 1
AHTH::AddAltGroupID BW:AS 56 0 4
AHTH::AddAltGroupID BW:AS 60 0 2
AHTH::AddAltGroupID BW:AS 60 0 4
AHTH::AddAltGroupID BW:AS 120 0 2
AHTH::AddAltGroupID BW:AS 120 0 5
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddCString 1 MimeType audio/AMR
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2
AHTH::AddULONG32 2 StreamNumber 1
AHTH::AddULONG32 2 Duration 150199
AHTH::AddULONG32 2 RTPPayloadType 98
AHTH::AddULONG32 2 AvgBitRate 44000
AHTH::AddULONG32 2 SamplesPerSecond 90000
AHTH::AddULONG32 2 alt-default-id 4
AHTH::AddULONG32 2 FMTPprofile-level-id 8
AHTH::AddULONG32 2 Preroll 1088
AHTH::AddCString 2 MimeType video/MP4V-ES
AHTH::AddCString 2 Control trackID=4
AHTH::AddCString 2 PayloadParameters "profile-level-id=8; config=01010000012000884006682C2090A21F"
AHTH::AddCString 2 FMTPconfig "01010000012000884006682C2090A21F"
AHTH::AddAltULONG32 2 3 AvgBitRate 16000
AHTH::AddAltULONG32 2 3 Preroll 533
AHTH::AddAltCString 2 3 Control trackID=3
AHTH::AddAltULONG32 2 5 AvgBitRate 104000
AHTH::AddAltCString 2 5 Control trackID=5
AHTH::AddAltULONG32 2 5 Preroll 1666

# set selection criteria and select the stream
Reset
AddMaxBWFilter 10000
AddHighestBWFilter
Select

# check session level fields
IntCount 0 3
GetInt 0 StreamCount 2
GetInt 0 Duration 150199
GetInt 0 AvgBitRate 56000
StringCount 0 2
GetString 0 Control *
GetString 0 MulticastAddress 0.0.0.0
BufferCount 0 0
ObjectCount 0 0

# check stream 0 fields
IntCount 1 6
GetInt 1 StreamNumber 0
GetInt 1 Duration 150199
GetInt 1 RTPPayloadType 97
GetInt 1 AvgBitRate 12000
GetInt 1 SamplesPerSecond 8000
GetInt 1 FMTPoctet-align 1
StringCount 1 3
GetString 1 MimeType audio/AMR
GetString 1 Control trackID=1
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# check stream 1 fields
IntCount 2 7
GetInt 2 StreamNumber 1
GetInt 2 Duration 150199
GetInt 2 RTPPayloadType 98
GetInt 2 AvgBitRate 44000
GetInt 2 SamplesPerSecond 90000
GetInt 2 FMTPprofile-level-id 8
GetInt 2 Preroll 1088
StringCount 2 4
GetString 2 MimeType video/MP4V-ES
GetString 2 Control trackID=4
GetString 2 PayloadParameters "profile-level-id=8; config=01010000012000884006682C2090A21F"
GetString 2 FMTPconfig "01010000012000884006682C2090A21F"
BufferCount 2 0
ObjectCount 2 0



# Test language based selection

# Test simple language based selection
#
# v=0
# a=alt-group:LANG:RFC3066:en=1;se=2
# a=alt-group:BW:AS:12=1;16=2
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddAltGroupID LANG:RFC3066 en 0 1
AHTH::AddAltGroupID LANG:RFC3066 se 0 2
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 16 0 2
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2

# set selection criteria and select the stream
Reset
AddLanguageFilter en
AddMaxBWFilter 30000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 12000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=1
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# Test simple language based selection (case 2)
#
# v=0
# a=alt-group:LANG:RFC3066:en=1;se=2
# a=alt-group:BW:AS:12=1;16=2
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddAltGroupID LANG:RFC3066 en 0 1
AHTH::AddAltGroupID LANG:RFC3066 se 0 2
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 16 0 2
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2

# set selection criteria and select the stream
Reset
AddLanguageFilter se
AddMaxBWFilter 30000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 16000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=2
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# Test simple language based selection with intermixed
# bandwidth and languages
#
# v=0
# a=alt-group:LANG:RFC3066:en=1,2;se=3,4
# a=alt-group:BW:AS:12=1;16=2;13=3;18=4
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2
# a=alt:3:b=AS:13
# a=alt:3:a=control:trackID=3
# a=alt:4:b=AS:18
# a=alt:4:a=control:trackID=4

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddAltGroupID LANG:RFC3066 en 0 1
AHTH::AddAltGroupID LANG:RFC3066 en 0 2
AHTH::AddAltGroupID LANG:RFC3066 se 0 3
AHTH::AddAltGroupID LANG:RFC3066 se 0 4
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 16 0 2
AHTH::AddAltGroupID BW:AS 13 0 3
AHTH::AddAltGroupID BW:AS 18 0 4
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2
AHTH::AddAltULONG32 1 3 AvgBitRate 13000
AHTH::AddAltCString 1 3 Control trackID=3
AHTH::AddAltULONG32 1 4 AvgBitRate 18000
AHTH::AddAltCString 1 4 Control trackID=4

# set selection criteria and select the stream
Reset
AddLanguageFilter se
AddMaxBWFilter 30000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 18000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=4
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# Test simple language based selection with intermixed
# bandwidth and languages (case 2)
#
# v=0
# a=alt-group:LANG:RFC3066:en=1,2;se=3,4
# a=alt-group:BW:AS:12=1;16=2;13=3;18=4
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2
# a=alt:3:b=AS:13
# a=alt:3:a=control:trackID=3
# a=alt:4:b=AS:18
# a=alt:4:a=control:trackID=4

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddAltGroupID LANG:RFC3066 en 0 1
AHTH::AddAltGroupID LANG:RFC3066 en 0 2
AHTH::AddAltGroupID LANG:RFC3066 se 0 3
AHTH::AddAltGroupID LANG:RFC3066 se 0 4
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 16 0 2
AHTH::AddAltGroupID BW:AS 13 0 3
AHTH::AddAltGroupID BW:AS 18 0 4
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2
AHTH::AddAltULONG32 1 3 AvgBitRate 13000
AHTH::AddAltCString 1 3 Control trackID=3
AHTH::AddAltULONG32 1 4 AvgBitRate 18000
AHTH::AddAltCString 1 4 Control trackID=4

# set selection criteria and select the stream
Reset
AddLanguageFilter en
AddMaxBWFilter 30000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 16000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=2
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# Test simple language based selection with intermixed
# bandwidth and languages (case 3)
#
# v=0
# a=alt-group:LANG:RFC3066:en=1,2;se=3,4
# a=alt-group:BW:AS:12=1;16=2;13=3;18=4
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2
# a=alt:3:b=AS:13
# a=alt:3:a=control:trackID=3
# a=alt:4:b=AS:18
# a=alt:4:a=control:trackID=4

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddAltGroupID LANG:RFC3066 en 0 1
AHTH::AddAltGroupID LANG:RFC3066 en 0 2
AHTH::AddAltGroupID LANG:RFC3066 se 0 3
AHTH::AddAltGroupID LANG:RFC3066 se 0 4
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 16 0 2
AHTH::AddAltGroupID BW:AS 13 0 3
AHTH::AddAltGroupID BW:AS 18 0 4
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2
AHTH::AddAltULONG32 1 3 AvgBitRate 13000
AHTH::AddAltCString 1 3 Control trackID=3
AHTH::AddAltULONG32 1 4 AvgBitRate 18000
AHTH::AddAltCString 1 4 Control trackID=4

# set selection criteria and select the stream
Reset
AddLanguageFilter se
AddMaxBWFilter 15000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 13000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=3
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# Test simple language based selection with intermixed
# bandwidth and languages (case 4)
#
# v=0
# a=alt-group:LANG:RFC3066:en=1,2;se=3,4
# a=alt-group:BW:AS:12=1;16=2;13=3;18=4
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2
# a=alt:3:b=AS:13
# a=alt:3:a=control:trackID=3
# a=alt:4:b=AS:18
# a=alt:4:a=control:trackID=4

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddAltGroupID LANG:RFC3066 en 0 1
AHTH::AddAltGroupID LANG:RFC3066 en 0 2
AHTH::AddAltGroupID LANG:RFC3066 se 0 3
AHTH::AddAltGroupID LANG:RFC3066 se 0 4
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 16 0 2
AHTH::AddAltGroupID BW:AS 13 0 3
AHTH::AddAltGroupID BW:AS 18 0 4
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2
AHTH::AddAltULONG32 1 3 AvgBitRate 13000
AHTH::AddAltCString 1 3 Control trackID=3
AHTH::AddAltULONG32 1 4 AvgBitRate 18000
AHTH::AddAltCString 1 4 Control trackID=4

# set selection criteria and select the stream
Reset
AddLanguageFilter en
AddMaxBWFilter 15000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 12000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=1
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# Test the case where the lowest bandwith for
# the desired language is above the max bandwidth
# constraint. The default stream should be selected
# in this case
#
# v=0
# a=alt-group:LANG:RFC3066:en=1;se=2
# a=alt-group:BW:AS:12=1;16=2
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddAltGroupID LANG:RFC3066 en 0 1
AHTH::AddAltGroupID LANG:RFC3066 se 0 2
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 16 0 2
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2

# set selection criteria and select the stream
Reset
AddLanguageFilter se
AddMaxBWFilter 15000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 12000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=1
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# Test the case where the desired language is not
# available.The default stream should be selected
# in this case
#
# v=0
# a=alt-group:LANG:RFC3066:en=1;se=2
# a=alt-group:BW:AS:12=1;16=2
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddAltGroupID LANG:RFC3066 en 0 1
AHTH::AddAltGroupID LANG:RFC3066 se 0 2
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 16 0 2
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2

# set selection criteria and select the stream
Reset
AddLanguageFilter de
AddMaxBWFilter 30000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 12000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=1
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# Test the case where the desired language tag is
# less specific than the content language tag
# (ie desired language = en, content language = en-US)
#
# v=0
# a=alt-group:LANG:RFC3066:en-US=2;se=1
# a=alt-group:BW:AS:12=1;16=2
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddAltGroupID LANG:RFC3066 en-US 0 2
AHTH::AddAltGroupID LANG:RFC3066 se 0 1
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 16 0 2
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2

# set selection criteria and select the stream
Reset
AddLanguageFilter en
AddMaxBWFilter 30000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 16000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=2
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0


# Test language based selection with intermixed
# bandwidth and multiple languages specified
#
# v=0
# a=alt-group:LANG:RFC3066:en=1,2;se=3,4
# a=alt-group:BW:AS:12=1;16=2;13=3;18=4
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:16
# a=alt:2:a=control:trackID=2
# a=alt:3:b=AS:13
# a=alt:3:a=control:trackID=3
# a=alt:4:b=AS:18
# a=alt:4:a=control:trackID=4

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddAltGroupID LANG:RFC3066 en 0 1
AHTH::AddAltGroupID LANG:RFC3066 en 0 2
AHTH::AddAltGroupID LANG:RFC3066 se 0 3
AHTH::AddAltGroupID LANG:RFC3066 se 0 4
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 16 0 2
AHTH::AddAltGroupID BW:AS 13 0 3
AHTH::AddAltGroupID BW:AS 18 0 4
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 16000
AHTH::AddAltCString 1 2 Control trackID=2
AHTH::AddAltULONG32 1 3 AvgBitRate 13000
AHTH::AddAltCString 1 3 Control trackID=3
AHTH::AddAltULONG32 1 4 AvgBitRate 18000
AHTH::AddAltCString 1 4 Control trackID=4

# set selection criteria and select the stream
Reset
AddLanguageFilter "de,en"
AddMaxBWFilter 60000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 16000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=2
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# test mimetype filtering.
# NOTE : Eventhough the bandwidth criteria allows the audio/MP4-LATM
#        group to be selected, the mimetype is not supported so
#        the highest bitrate with a supported mimetype is selected
# v=0
# a=alt-group:BW:AS:12=1;18=2;64=3
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:18
# a=alt:2:a=control:trackID=2
# a=alt:2:a=rtpmap:97 AMR-WB/16000
# a=alt:2:b=AS:64
# a=alt:2:a=control:trackID=3
# a=alt:2:a=rtpmap:97 MP4-LATM/44100

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 18 0 2
AHTH::AddAltGroupID BW:AS 64 0 3
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 18000
AHTH::AddAltULONG32 1 2 SamplesPerSecond 16000
AHTH::AddAltCString 1 2 Control trackID=2
AHTH::AddAltCString 1 2 MimeType audio/AMR-WB
AHTH::AddAltULONG32 1 3 AvgBitRate 64000
AHTH::AddAltULONG32 1 3 SamplesPerSecond 44100
AHTH::AddAltCString 1 3 Control trackID=3
AHTH::AddAltCString 1 3 MimeType audio/MP4-LATM

# set selection criteria and select the stream

# set the supported mimetypes
SetMimetypes audio/AMR,audio/AMR-WB

Reset
AddMimetypeFilter
AddMaxBWFilter 1000000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 18000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 16000
StringCount 1 3
GetString 1 Control trackID=2
GetString 1 Mimetype "audio/AMR-WB"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0

# test mimetype filtering.
# NOTE : The bandwidth criteria allows the the audio/AMR and audio/AMR-WB
#        alt-groups to be selected. Neither of these mimetypes are supported.
#        Since the selection code cannot find an alt-group that satisfies
#        the specified criteria, it selects the default group.
# v=0
# a=alt-group:BW:AS:12=1;18=2;64=3
# m=audio 0 RTP/AVP 97
# b=AS:12
# a=rtpmap:97 AMR/8000
# a=control:trackID=1
# a=fmtp:97 octet-align=1
# a=range:npt=0-150.2
# a=alt-default-id:1
# a=alt:2:b=AS:18
# a=alt:2:a=control:trackID=2
# a=alt:2:a=rtpmap:97 AMR-WB/16000
# a=alt:2:b=AS:64
# a=alt:2:a=control:trackID=3
# a=alt:2:a=rtpmap:97 MP4-LATM/44100

# generate the expected fields generated by this SDP
AHTH::Clear
AHTH::AddAltGroupID BW:AS 12 0 1
AHTH::AddAltGroupID BW:AS 18 0 2
AHTH::AddAltGroupID BW:AS 64 0 3
AHTH::AddULONG32 0 StreamCount 1
AHTH::AddULONG32 1 AvgBitRate 12000
AHTH::AddULONG32 1 RTPPayloadType 97
AHTH::AddULONG32 1 StreamNumber 0
AHTH::AddULONG32 1 alt-default-id 1
AHTH::AddULONG32 1 FMTPoctet-align 1
AHTH::AddULONG32 1 Duration 150199
AHTH::AddULONG32 1 SamplesPerSecond 8000
AHTH::AddCString 1 Control trackID=1
AHTH::AddCString 1 Mimetype "audio/AMR"
AHTH::AddCString 1 PayloadParameters "octet-align=1"
AHTH::AddAltULONG32 1 2 AvgBitRate 18000
AHTH::AddAltULONG32 1 2 SamplesPerSecond 16000
AHTH::AddAltCString 1 2 Control trackID=2
AHTH::AddAltCString 1 2 MimeType audio/AMR-WB
AHTH::AddAltULONG32 1 3 AvgBitRate 64000
AHTH::AddAltULONG32 1 3 SamplesPerSecond 44100
AHTH::AddAltCString 1 3 Control trackID=3
AHTH::AddAltCString 1 3 MimeType audio/MP4-LATM

# set selection criteria and select the stream

# set the supported mimetypes
SetMimetypes audio/MP4-LATM

Reset
AddMimetypeFilter
AddMaxBWFilter 30000
AddHighestBWFilter
Select

IntCount 0 1
GetInt 0 StreamCount 1
StringCount 0 0
BufferCount 0 0
ObjectCount 0 0
IntCount 1 6
GetInt 1 AvgBitRate 12000
GetInt 1 RTPPayloadType 97
GetInt 1 StreamNumber 0
GetInt 1 FMTPoctet-align 1
GetInt 1 Duration 150199
GetInt 1 SamplesPerSecond 8000
StringCount 1 3
GetString 1 Control trackID=1
GetString 1 Mimetype "audio/AMR"
GetString 1 PayloadParameters "octet-align=1"
BufferCount 1 0
ObjectCount 1 0
